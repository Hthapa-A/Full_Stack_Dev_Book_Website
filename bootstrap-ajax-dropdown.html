<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ajax and Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container mt-3">
      <!-- Back button on the left -->
      <a href="https://mi-linux.wlv.ac.uk/~2415267/index.php" class="btn btn-primary mb-3">‚Üê Return</a>

      <h1>Ajax and Bootstrap demo</h1>
      
      <div class="dropdown" id="myDropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          Dropdown button
        </button>
        <ul class="dropdown-menu" id="myList"></ul>
      </div>   
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const myDropdown = document.getElementById('myDropdown');
      myDropdown.addEventListener('show.bs.dropdown', event => {

        const myList = document.getElementById('myList');
        myList.innerHTML = '<li class="px-3 py-2"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></li>';
        
        fetch('https://mi-linux.wlv.ac.uk/~2415267/ajax_books.php')
        .then(response => response.json())
        .then(response => {
          myList.innerHTML = '';
          response.forEach(book => {
            var li = document.createElement("li");
            var a = document.createElement("a");
            a.innerHTML = `${book.title} by ${book.author}`;
            a.href = 'https://mi-linux.wlv.ac.uk/~2415267/details.php?id=' + book.id;
            a.classList.add("dropdown-item");
            li.appendChild(a);
            myList.appendChild(li);            
          });
        });
      });
    </script>
  </body>
</html>
